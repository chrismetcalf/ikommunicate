<!doctype html>
<html>

<head>
  <meta charset="utf-8"/>
  <title>Depth Gauge</title>
  <meta name="viewport" content="width=device-width">

  <style>
  .container {
    width: 640px;
    margin: 0 auto;
    text-align: center;
  }

  .gauge {
    width: 640px;
    height: 640px;
  }

  a:link.button,
  a:active.button,
  a:visited.button,
  a:hover.button {
    margin: 30px 5px 0 2px;
    padding: 7px 13px;
  }

  </style>

</head>


<body>

  <div class="container">
    <div id="gg1" class="gauge"></div>
    <p id="gg1_text">0-10 is red, 11-100 is Green</p>
  </div>

  <script src="depthLibrary/raphael-2.1.4.min.js"></script>
  
  <script src="depthLibrary/justgage.js"></script>
  
  <script>
  document.addEventListener("DOMContentLoaded", function(event) {
    var gg1 = new JustGage({
      id: "gg1",
      value : 0,
      min: 0,
      max: 100,
      decimals: 1,
	  title: "Depth",
      label: "Meters",
      gaugeWidthScale: 0.6,
      customSectors: [{
        color : "#ff0000",
        lo : 0,
        hi : 10
      },{
        color : "#00ff00",
        lo : 10,
        hi : 100
      }],
      counter: true
    });
	setInterval(function() {
            gg1.refresh(depthForGauge);
            }, 1000);
  });
  </script>
  
  <script>

// First ask user what IP Address iKommunicate is
var ipaddr = prompt("Please enter iKommunicate IP Address", "i.e. 192.168.1.20");
// Ideally you would get the IP address automatically using Bonjour/mDNS

var dataDiv = document.getElementById('data');
var depthBelowTransducer = 0;
var depthForGauge = 0;

function updateDisplay(event) {
//  console.log(event.target.responseText)
  var depthRaw = JSON.parse(event.target.responseText);
  depthBelowTransducer = depthRaw.belowTransducer.value;
  depthForGauge = depthBelowTransducer.toPrecision(3);
  console.log(depthBelowTransducer)
  setTimeout(fetchDataFromRestApi, 1000);
}

function fetchDataFromRestApi() {
	var oReq = new XMLHttpRequest();
	oReq.addEventListener("load", updateDisplay);
	oReq.open("GET", "http://" + ipaddr + "/signalk/v1/api/vessels/self/environment/depth");
	oReq.send();
} 

fetchDataFromRestApi();   

</script>

</body>

</html>